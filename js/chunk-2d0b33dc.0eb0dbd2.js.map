{"version":3,"sources":["webpack:///./src/views/CheckoutPay.vue?bb0f","webpack:///src/views/CheckoutPay.vue","webpack:///./src/views/CheckoutPay.vue?53cd","webpack:///./src/views/CheckoutPay.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","active","isLoading","on","update:active","$event","staticClass","_v","_s","finalTotal","for","directives","name","rawName","value","expression","class","is-invalid","errors","has","type","placeholder","click","preventDefault","backToInfo","pay","staticRenderFns","CheckoutPayvue_type_script_lang_js_","data","orderID","orderTotal","methods","Object","objectSpread","vm","$validator","validate","then","_ref","asyncToGenerator","regeneratorRuntime","mark","_callee","result","payApi","wrap","_context","prev","next","createOrder","userdata","orderInfo","orderId","concat","$http","post","response","success","$router","push","alert","stop","_x","apply","arguments","vuex_esm","created","getCartList","currentStep","user","trim","email","address","tel","computed","get","$store","state","cartModule","set","commit","root","views_CheckoutPayvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__"],"mappings":"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","file":"js/chunk-2d0b33dc.0eb0dbd2.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('loading',{attrs:{\"active\":_vm.isLoading},on:{\"update:active\":function($event){_vm.isLoading=$event}}}),_c('section',{staticClass:\"row justify-content-center mt-4 mt-md-5\"},[_c('div',{staticClass:\"col-10 col-md-8\"},[_c('h4',{staticClass:\"text-center\"},[_vm._v(\"總金額：\"+_vm._s(_vm.finalTotal))]),_c('h5',{staticClass:\"py-3 mt-4 mt-md-5 mb-2 text-center bg-light\"},[_vm._v(\"付款\")]),_c('div',{staticClass:\"form-row\"},[_c('div',{staticClass:\"form-group col-md\"},[_c('label',{attrs:{\"for\":\"\"}},[_vm._v(\"姓名\")]),_c('input',{directives:[{name:\"validate\",rawName:\"v-validate\",value:('required'),expression:\"'required'\"}],staticClass:\"form-control\",class:{'is-invalid': _vm.errors.has('name')},attrs:{\"type\":\"text\",\"placeholder\":\"姓名\",\"name\":\"name\"}})]),_c('div',{staticClass:\"form-group col-md\"},[_c('label',{attrs:{\"for\":\"\"}},[_vm._v(\"電話\")]),_c('input',{directives:[{name:\"validate\",rawName:\"v-validate\",value:('required|numeric'),expression:\"'required|numeric'\"}],staticClass:\"form-control\",class:{'is-invalid': _vm.errors.has('tel')},attrs:{\"type\":\"text\",\"placeholder\":\"電話\",\"name\":\"tel\"}})])]),_c('div',{staticClass:\"row d-flex justify-content-end mt-4\"},[_c('button',{staticClass:\"btn btn-secondary mr-3\",on:{\"click\":function($event){$event.preventDefault();return _vm.backToInfo()}}},[_vm._v(\"回訂單資料\")]),_c('button',{staticClass:\"btn btn-outline-primary\",on:{\"click\":function($event){$event.preventDefault();return _vm.pay()}}},[_vm._v(\"確認付款\")])])])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <loading :active.sync=\"isLoading\"></loading>\r\n    <section class=\"row justify-content-center mt-4 mt-md-5\">\r\n      <div class=\"col-10 col-md-8\">\r\n        <h4 class=\"text-center\">總金額：{{ finalTotal }}</h4>\r\n        <h5 class=\"py-3 mt-4 mt-md-5 mb-2 text-center bg-light\">付款</h5>\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group col-md\">\r\n            <label for>姓名</label>\r\n            <input\r\n              type=\"text\"\r\n              class=\"form-control\"\r\n              placeholder=\"姓名\"\r\n              name=\"name\"\r\n              v-validate=\"'required'\"\r\n              :class=\"{'is-invalid': errors.has('name')}\"\r\n            >\r\n          </div>\r\n          <div class=\"form-group col-md\">\r\n            <label for>電話</label>\r\n            <input\r\n              type=\"text\"\r\n              class=\"form-control\"\r\n              placeholder=\"電話\"\r\n              name=\"tel\"\r\n              v-validate=\"'required|numeric'\"\r\n              :class=\"{'is-invalid': errors.has('tel')}\"\r\n            >\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"row d-flex justify-content-end mt-4\">\r\n          <button class=\"btn btn-secondary mr-3\" @click.prevent=\"backToInfo()\">回訂單資料</button>\r\n          <button class=\"btn btn-outline-primary\" @click.prevent=\"pay()\">確認付款</button>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { mapGetters, mapActions } from 'vuex'\r\n\r\nexport default {\r\n  // props: ['userdata'],\r\n  data () {\r\n    return {\r\n      orderID: '',\r\n      orderTotal: 0\r\n    }\r\n  },\r\n  methods: {\r\n    pay () {\r\n      var vm = this\r\n      vm.$validator.validate().then(async function (result) {\r\n        if (result) {\r\n          // 成立訂單\r\n          await vm.createOrder(vm.userdata)\r\n          vm.orderID = vm.orderInfo.orderId\r\n          // 付款\r\n          const payApi = `${process.env.VUE_APP_API}/api/${\r\n            process.env.VUE_APP_CUSTOM\r\n          }/pay/${vm.orderID}`\r\n          vm.$http.post(payApi).then(response => {\r\n            if (response.data.success) {\r\n              vm.$router.push(`/finish/${vm.orderID}`)\r\n              // vm.$emit('step', vm.currentStep = 'finish')\r\n            } else {\r\n              alert('付款失敗')\r\n            }\r\n          })\r\n        } else {\r\n          // console.log(\"資料有誤\")\r\n        }\r\n      })\r\n    },\r\n    backToInfo () {\r\n      this.$router.push('/checkout')\r\n    },\r\n    ...mapActions('cartModule', ['getCartList', 'delCart']),\r\n    ...mapActions('orderModule', ['createOrder'])\r\n  },\r\n  created () {\r\n    this.getCartList()\r\n    this.currentStep = 'pay'\r\n    // 防止沒有使用者資料直接導到付款頁面\r\n    if (this.userdata.user.name.trim() === '' || this.userdata.user.email.trim() === '' ||\r\n    this.userdata.user.address.trim() === '' || this.userdata.user.tel.trim() === '') {\r\n      this.$router.push(`/checkout`)\r\n    }\r\n  },\r\n  computed: {\r\n    currentStep: {\r\n      get () {\r\n        return this.$store.state.cartModule.currentStep\r\n      },\r\n      set (value) {\r\n        this.$store.commit('cartModule/CURRENTSTEP', value, { root: true })\r\n      }\r\n    },\r\n    ...mapGetters(['isLoading']),\r\n    ...mapGetters('cartModule', ['cartlist', 'finalTotal', 'status', 'userdata']),\r\n    ...mapGetters('orderModule', ['orderInfo'])\r\n\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CheckoutPay.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CheckoutPay.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CheckoutPay.vue?vue&type=template&id=2f204e75&\"\nimport script from \"./CheckoutPay.vue?vue&type=script&lang=js&\"\nexport * from \"./CheckoutPay.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}